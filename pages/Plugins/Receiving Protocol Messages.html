<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Receiving Protocol Messages | @skeldjs/hindenburg</title>
	<meta name="description" content="Documentation for @skeldjs/hindenburg">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">@skeldjs/hindenburg</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="Creating a Plugin.html">Plugins</a>
				</li>
				<li>
					<a href="Receiving Protocol Messages.html">Receiving Protocol Messages</a>
				</li>
			</ul>
			<h1>Receiving Protocol Messages</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p>While the SkeldJS API covers almost every aspect of Among Us, it might still be necessary to go even further down. This is where instead of listening to events that are emitted by SkeldJS for things that happen, you can listen directly for messages received via the Among Us protocol.</p>
				<blockquote>
					<p>You can only override messages on worker plugins.</p>
				</blockquote>
				<a href="#custom-rpcs" id="custom-rpcs" style="color: inherit; text-decoration: none;">
					<h2>Custom RPCs</h2>
				</a>
				<p>If you&#39;re writing custom innernet objects with custom Rpc methods, check out the {@page Handling Custom RPCs} page for a much more suitable API.</p>
				<a href="#attaching-listeners" id="attaching-listeners" style="color: inherit; text-decoration: none;">
					<h2>Attaching Listeners</h2>
				</a>
				<p>The <a href="../../modules.html#MessageHandler"><code>MessageHandler</code></a> decorator can be used with a method to denote it as being used to listen for messages.</p>
				<p>For example:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-fun-things&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">FunThingsPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">WorkerPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    @</span><span style="color: #795E26">MessageHandler</span><span style="color: #000000">(</span><span style="color: #001080">EndGameMessage</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #795E26">onEndGameMessage</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">: </span><span style="color: #267F99">EndGameMessage</span><span style="color: #000000">, </span><span style="color: #001080">ctx</span><span style="color: #000000">: </span><span style="color: #267F99">PacketContext</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #001080">sender</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">?.</span><span style="color: #795E26">destroy</span><span style="color: #000000">(); </span><span style="color: #008000">// destroy the room as soon as the game ends</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>You can pass in <a href="https://skeld.js.org/modules/protocol.html">any valid protocol message class</a> as the first argument.</p>
				<blockquote>
					<p>If you&#39;re using custom protocol messages, you may have to register them with Hindenburg; check out the {@page Custom Protocol Messages} page.</p>
				</blockquote>
				<p>The body of your method can be marked as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><em>async</em></a>, and takes in 2 parameters:</p>
				<a href="#message" id="message" style="color: inherit; text-decoration: none;">
					<h4><code>message</code></h4>
				</a>
				<p>This is an instance of the message that you are listening for, after being through the message class&#39; <a href="https://skeld.js.org/classes/protocol.BaseMessage.html#Deserialize">Deserialize</a> method.</p>
				<p>In TypeScript, the type of this parameter <em>must</em> be an instance of the message class that you passed into the <code>@MessageHandler</code> decorator.</p>
				<a href="#ctx" id="ctx" style="color: inherit; text-decoration: none;">
					<h4><code>ctx</code></h4>
				</a>
				<p>An object containing some basic context information about the packet. Check the docs for <a href="../../interfaces/PacketContext.html">PacketContext</a> for information.</p>
				<a href="#overriding-default-behaviour" id="overriding-default-behaviour" style="color: inherit; text-decoration: none;">
					<h2>Overriding Default Behaviour</h2>
				</a>
				<p>By default, the <code>@MessageHandler</code> decorator will attach a listener on top of any existing ones; meaning it gets called alongside those.</p>
				<p>If, however, you wanted to override the default behaviour of the message, you can pass in options to <code>@MessageHandler</code>:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-fun-things&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">FunThingsPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">WorkerPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    @</span><span style="color: #795E26">MessageHandler</span><span style="color: #000000">(</span><span style="color: #001080">EndGameMessage</span><span style="color: #000000">, { </span><span style="color: #001080">override:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> })</span>
<span style="color: #000000">    </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #795E26">onEndGameMessage</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">: </span><span style="color: #267F99">EndGameMessage</span><span style="color: #000000">, { </span><span style="color: #001080">sender</span><span style="color: #000000"> }: </span><span style="color: #267F99">PacketContext</span><span style="color: #000000">, </span><span style="color: #001080">originalListeners</span><span style="color: #000000">: </span><span style="color: #267F99">MessageHandlerCallback</span><span style="color: #000000">&lt;</span><span style="color: #267F99">EndGameMessage</span><span style="color: #000000">&gt;[]) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">sender</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">?.</span><span style="color: #795E26">handleEnd</span><span style="color: #000000">(</span><span style="color: #001080">GameOverReason</span><span style="color: #000000">.</span><span style="color: #001080">ImpostorByKill</span><span style="color: #000000">); </span><span style="color: #008000">// always let impostors win due to killing all of the crewmates</span>
<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #795E26">info</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;Ended game!!&quot;</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>Check out <a href="../../interfaces/MessageHandlerOptions.html">MessageHandlerOptions</a> for a list of more options.</p>
				</blockquote>
				<p>This will clear any other previously attached listeners before attaching, and provide you with those in the method via the additional <code>originalListeners</code> argument.</p>
				<blockquote>
					<p>Note that this will also override any listeners from other plugins; including those that were overrides themselves. If you want to make sure that yours reigns supreme and is not overriden, make sure your <a href="Load Ordering.html">plugin load ordering</a> is on &quot;last&quot;. To be curteous to those plugins, however, please call them using the <code>originalListeners</code> argument.</p>
				</blockquote>
				<a href="#originallisteners" id="originallisteners" style="color: inherit; text-decoration: none;">
					<h3><code>originalListeners</code></h3>
				</a>
				<p>An array containing every other previous listener before they were overriden by your method.</p>
				<p>Rather annoyingly, due to a <a href="https://github.com/Microsoft/TypeScript#4881">long standing issue with TypeScript</a>, you will have to annotate the parameter with a long type: <code>originalListeners: MessageHandlerCallback&lt;YourMessage&gt;[]</code>.</p>
				<a href="#calling-original-overriden-listeners" id="calling-original-overriden-listeners" style="color: inherit; text-decoration: none;">
					<h2>Calling Original Overriden Listeners</h2>
				</a>
				<p>One reason you may want to have access to the original listeners of the message may be so you can modify the message, similar to a hook. This can be done fairly simply by looping through the array and calling each listener manually:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-fun-things&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">FunThingsPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">WorkerPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    @</span><span style="color: #795E26">MessageHandler</span><span style="color: #000000">(</span><span style="color: #001080">EndGameMessage</span><span style="color: #000000">, { </span><span style="color: #001080">override:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000"> })</span>
<span style="color: #000000">    </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #795E26">onEndGameMessage</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">: </span><span style="color: #267F99">EndGameMessage</span><span style="color: #000000">, </span><span style="color: #001080">ctx</span><span style="color: #000000">: </span><span style="color: #267F99">PacketContext</span><span style="color: #000000">, </span><span style="color: #001080">originalListeners</span><span style="color: #000000">: </span><span style="color: #267F99">MessageHandlerCallback</span><span style="color: #000000">&lt;</span><span style="color: #267F99">EndGameMessage</span><span style="color: #000000">&gt;[]) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">ctx</span><span style="color: #000000">.</span><span style="color: #001080">sender</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">?.</span><span style="color: #795E26">destroy</span><span style="color: #000000">();</span>

<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">altered</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">EndGameMessage</span><span style="color: #000000">(</span>
<span style="color: #000000">            </span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">code</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">GameOverReason</span><span style="color: #000000">.</span><span style="color: #001080">ImpostorByKill</span><span style="color: #000000">, </span><span style="color: #008000">// always show that impostors won due to killing all of the crewmates</span>
<span style="color: #000000">            </span><span style="color: #0000FF">false</span>
<span style="color: #000000">        );</span>

<span style="color: #000000">        </span><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">listener</span><span style="color: #000000"> </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">originalListeners</span><span style="color: #000000">) {</span>
<span style="color: #000000">            </span><span style="color: #795E26">listener</span><span style="color: #000000">(</span><span style="color: #001080">altered</span><span style="color: #000000">, </span><span style="color: #001080">ctx</span><span style="color: #000000">);</span>
<span style="color: #000000">        }</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>If you want to call each listener sequentially, waiting for each to finish before running the next, simply <code>await</code>:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">listener</span><span style="color: #000000"> </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">originalListeners</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">listener</span><span style="color: #000000">(</span><span style="color: #001080">altered</span><span style="color: #000000">, </span><span style="color: #001080">ctx</span><span style="color: #000000">);</span>
<span style="color: #000000">}</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting <wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installation.html">Installation</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Environment Variables.html">Environment <wbr>Variables</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Configuration.html">Configuration</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installing Plugins.html">Installing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Contributing.html">Contributing</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Comparison with Impostor.html">Comparison with <wbr>Impostor</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Using <wbr>Hindenburg</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Logging Config.html">Logging <wbr>Config</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Reactor Support.html">Reactor <wbr>Support</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Server-as-a-Host.html">Server-<wbr>as-<wbr>a-<wbr>Host</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Advanced <wbr>Usage</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Unknown Innernet Objects.html">Unknown <wbr>Innernet <wbr>Objects</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Message Ordering.html">Message <wbr>Ordering</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Plugins</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Creating a Plugin.html">Creating a <wbr>Plugin</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Developing Plugins.html">Developing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Compatible Hindenburg API Versions.html">Compatible <wbr>Hindenburg API <wbr>Versions</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Publishing Plugins.html">Publishing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Load Ordering.html">Load <wbr>Ordering</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Worker and Room Plugins.html">Worker and <wbr>Room <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Lifecycle Methods.html">Lifecycle <wbr>Methods</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Event Listeners.html">Event <wbr>Listeners</a>
					</li>
					<li class="current pp-nav pp-page">
						<a href="Receiving Protocol Messages.html">Receiving <wbr>Protocol <wbr>Messages</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Custom Roles.html">Custom <wbr>Roles</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>