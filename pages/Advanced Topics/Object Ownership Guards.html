<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Object Ownership Guards | @skeldjs/hindenburg</title>
	<meta name="description" content="Documentation for @skeldjs/hindenburg">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">@skeldjs/hindenburg</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="Object Ownership Guards.html">Advanced Topics</a>
				</li>
				<li>
					<a href="Object Ownership Guards.html">Object Ownership Guards</a>
				</li>
			</ul>
			<h1>Object Ownership Guards</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p>If you don&#39;t already know, <em>Innernet Objects</em> in Among Us are used to create state for some aspect of the game, and to network and sync that state between clients. A player, for example, has three innernet objects dedicated to keeping state about various things; <code>PlayerControl</code> for general behaviours, <code>PlayerPhysics</code> for movement states (e.g. ladders, vent, etc.) and <code>CustomNetworkTransform</code> for movement positions.</p>
				<p>In Hindenburg, in order to facilitate event safety and clear code flow, has the idea of objects being <em>owned</em> by either perspectives, or main rooms. In this way, for example, if a meeting is started by a player inside a perspective, while the meeting may be synced to every other client, nominally the meeting is said to be <em>owned</em> by that perspective. That means that the server will only perform host operations (i.e. handle votes, spawning, meeting ends, etc.) on that perspective, and the main room will simply listen for changes.</p>
				<blockquote>
					<p>Note that this only really applies if the server has SaaH enabled, see <a href="../Using Hindenburg/Server-as-a-Host.html">Server-as-a-Host</a>.</p>
				</blockquote>
				<p>In practice, this means that certain events that are host-only won&#39;t be able to be listened on by the main room, since they don&#39;t own the object. This does, fortunately, only applies to a small sub-set of events, for example the <a href="../../classes/PlayerDieEvent.html"><code>player.die</code></a> event:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">ImpostorDieHandler</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">EventTarget</span><span style="color: #000000"> {</span>
<span style="color: #000000">    @</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;player.die&quot;</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #795E26">onPlayerDie</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #267F99">PlayerDieEvent</span><span style="color: #000000">&lt;</span><span style="color: #267F99">BaseRoom</span><span style="color: #000000">&gt;) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">?.</span><span style="color: #001080">roleType</span><span style="color: #000000"> !== </span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">perspective</span><span style="color: #000000"> = </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #001080">playerPerspectives</span><span style="color: #000000">.</span><span style="color: #795E26">get</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">clientId</span><span style="color: #000000">);</span>
<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">impostorPov</span><span style="color: #000000"> = </span><span style="color: #001080">perspective</span><span style="color: #000000">?.</span><span style="color: #795E26">resolvePlayer</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">);</span>

<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">impostorPov</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #001080">impostorPov</span><span style="color: #000000">?.</span><span style="color: #001080">control</span><span style="color: #000000">?.</span><span style="color: #795E26">setName</span><span style="color: #000000">(</span><span style="color: #001080">impostorPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">!.</span><span style="color: #001080">defaultOutfit</span><span style="color: #000000">!.</span><span style="color: #001080">name</span><span style="color: #000000">.</span><span style="color: #795E26">replace</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;&lt;color=red&gt;Impostor&lt;/color&gt;&quot;</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;&lt;color=gray&gt;Dead&lt;/color&gt;&quot;</span><span style="color: #000000">));</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>

<span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-role-tags&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">RoleTagsPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">RoomPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    @</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;player.setrole&quot;</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #795E26">onPlayerSetRole</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #267F99">PlayerSetRoleEvent</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">newRole</span><span style="color: #000000"> !== </span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">perspective</span><span style="color: #000000"> = </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">createPerspective</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">);</span>
<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">impostorPov</span><span style="color: #000000"> = </span><span style="color: #001080">perspective</span><span style="color: #000000">.</span><span style="color: #795E26">resolvePlayer</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">);</span>

<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">impostorDieHandler</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">ImpostorDieHandler</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">impostorDieHandler</span><span style="color: #000000">);</span>
<span style="color: #000000">        </span><span style="color: #001080">perspective</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">impostorDieHandler</span><span style="color: #000000">);</span>

<span style="color: #000000">        </span><span style="color: #001080">impostorPov</span><span style="color: #000000">?.</span><span style="color: #001080">control</span><span style="color: #000000">?.</span><span style="color: #795E26">setName</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;&lt;color=red&gt;Impostor&lt;/color&gt;</span><span style="color: #EE0000">\n</span><span style="color: #A31515">&quot;</span><span style="color: #000000"> + </span><span style="color: #001080">impostorPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">!.</span><span style="color: #001080">defaultOutfit</span><span style="color: #000000">!.</span><span style="color: #001080">name</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>See <a href="../Plugins/Event Targets.html">Event Targets</a> for more information.</p>
				</blockquote>
				<p>This is significant as <code>player.die</code> is a <em>host-only</em> event, and with object ownerships, that means that only the room that <em>owns</em> the object that kills the player will receive the event.</p>
				<p>There are many sources of a players&#39; death, for example <em>meetings</em>, which is an object under the <code>MeetingHud</code> name. If a player <em>inside</em> a perspective starts a meeting, that meeting belongs to their perspective. When the meeting ends, and kills a player once they are exiled, only the perspective will receive the event that they have died.</p>
				<p>However, listening to events on the perspective is <em>not enough</em>, as if the meeting is instead spawned by a player on the main room, then the meeting will belong to the main room. Then, when a player is exiled towards the end of the meeting, only the main room will receive the even that they have died.</p>
				<p>The solution to this is to use the <a href="../../classes/EventTarget.html">EventTarget</a> API, as shown in the code above:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">impostorDieHandler</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">ImpostorDieHandler</span><span style="color: #000000">;</span>

<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">impostorDieHandler</span><span style="color: #000000">);</span>
<span style="color: #001080">perspective</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">impostorDieHandler</span><span style="color: #000000">);</span>
</code></pre>
				<p>This will listen for the event on either the room or the plugin, depending on where the death event comes from.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting <wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installation.html">Installation</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Environment Variables.html">Environment <wbr>Variables</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Configuration.html">Configuration</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installing Plugins.html">Installing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Contributing.html">Contributing</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Comparison with Impostor.html">Comparison with <wbr>Impostor</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Using <wbr>Hindenburg</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Logging Config.html">Logging <wbr>Config</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Reactor Support.html">Reactor <wbr>Support</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Server-as-a-Host.html">Server-<wbr>as-<wbr>a-<wbr>Host</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Server-as-a-Host.html">Interactive CLI</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Advanced <wbr>Usage</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Unknown Innernet Objects.html">Unknown <wbr>Innernet <wbr>Objects</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Message Ordering.html">Message <wbr>Ordering</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Plugins</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Creating a Plugin.html">Creating a <wbr>Plugin</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Developing Plugins.html">Developing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Compatible Hindenburg API Versions.html">Compatible <wbr>Hindenburg API <wbr>Versions</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Publishing Plugins.html">Publishing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Load Ordering.html">Load <wbr>Ordering</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Worker and Room Plugins.html">Worker and <wbr>Room <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Lifecycle Methods.html">Lifecycle <wbr>Methods</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Event Listeners.html">Event <wbr>Listeners</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Receiving Protocol Messages.html">Receiving <wbr>Protocol <wbr>Messages</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Player Perspectives.html">Player <wbr>Perspectives</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Event Targets.html">Event <wbr>Targets</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Reactor Integration.html">Reactor <wbr>Integration</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/End Game Intents.html">End <wbr>Game <wbr>Intents</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Server Broadcast.html">Server <wbr>Broadcast</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/CLI Commands.html">CLI <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Roles.html">Custom <wbr>Roles</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Innernet Objects.html">Custom <wbr>Innernet <wbr>Objects</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Protocol Messages.html">Custom <wbr>Protocol <wbr>Messages</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Game Codes.html">Game <wbr>Codes</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Advanced <wbr>Topics</span>
					</li>
					<li class="current pp-nav pp-page">
						<a href="Object Ownership Guards.html">Object <wbr>Ownership <wbr>Guards</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Guides</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Guides/New Roles.html">New <wbr>Roles</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Guides/Floating Text.html">Floating <wbr>Text</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>