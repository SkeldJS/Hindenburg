<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>New Roles | @skeldjs/hindenburg</title>
	<meta name="description" content="Documentation for @skeldjs/hindenburg">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">@skeldjs/hindenburg</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="New Roles.html">Guides</a>
				</li>
				<li>
					<a href="New Roles.html">New Roles</a>
				</li>
			</ul>
			<h1>New Roles</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p>To a degree, it is possible to create entire roles using entirely server code, making it work even on Vanilla clients.</p>
				<p>This guide will outline and explain the (general) steps you should take to create your own role.</p>
				<blockquote>
					<p>Note that this guide <em>requires</em> <a href="../Using Hindenburg/Server-as-a-Host.html">Server-as-a-Host</a> to be enabled.</p>
				</blockquote>
				<p>Specifically, we&#39;ll be creating the reasonably basic Jester role, and we&#39;ll be going through how you can analyse the game&#39;s code for yourself to bypass restrictions.</p>
				<blockquote>
					<p>Only very basic knowledge of programming is required for this guide, although the concepts do get somewhat complicated.</p>
				</blockquote>
				<a href="#create-the-plugin" id="create-the-plugin" style="color: inherit; text-decoration: none;">
					<h2>Create the plugin</h2>
				</a>
				<p>Obviously, you&#39;ll need to actually create the plugin. See <a href="../Plugins/Creating a Plugin.html">Creating a Plugin</a> to get started, or you can just run <code>yarn plugins create my-jester-mod</code> in your Hindenburg directory for a quick-start.</p>
				<blockquote>
					<p>In this guide we&#39;ll be using <a href="https://typescriptlang.org">TypeScript</a>, so make sure you enable that while creating your plugin.</p>
				</blockquote>
				<a href="#create-the-role-class" id="create-the-role-class" style="color: inherit; text-decoration: none;">
					<h2>Create the role class</h2>
				</a>
				<p>We can use SkeldJS&#39; role implementation to create a role <em>dummy</em> of sorts, that acts as a placeholder for simply stating that the player <em>is</em> the Jester; the role class itself won&#39;t do any logic.</p>
				<blockquote>
					<p>See <a href="../../enums/DisconnectReason.html#Custom">Roles</a> for more information.</p>
				</blockquote>
				<p>This is as simple as the following (in a new file, probably):</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">BaseRole</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">RoleTeamType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">RoleType</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@skeldjs/hindenburg&quot;</span><span style="color: #000000">;</span>

<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">JesterRole</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">BaseRole</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #001080">roleMetadata</span><span style="color: #000000"> = {</span>
<span style="color: #000000">        </span><span style="color: #001080">roleType:</span><span style="color: #000000"> </span><span style="color: #001080">RoleType</span><span style="color: #000000">.</span><span style="color: #001080">Crewmate</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">roleTeam:</span><span style="color: #000000"> </span><span style="color: #001080">RoleTeamType</span><span style="color: #000000">.</span><span style="color: #001080">Crewmate</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">isGhostRole:</span><span style="color: #000000"> </span><span style="color: #0000FF">false</span>
<span style="color: #000000">    };</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>The <code>JesterRole</code> class here extends the <a href="../../classes/BaseRole.html">BaseRole</a> class from SkeldJS; which is an essentially empty class but helps identify it and will make the class work with SkeldJS&#39; type system, as it will recognise that it&#39;s a descendent of <code>BaseRole</code>.</p>
				<p>The <em><code>roleMetadata</code></em> here will be identical to that of a Crewmate, since otherwise we would drop support for Vanilla clients. It doesn&#39;t matter, though, as this jester role only needs to exist on the server anyway.</p>
				<p>Other than that, this file is fairly light and doesn&#39;t have any logic. So far so good.</p>
				<blockquote>
					<p>Make sure to export everything from this file by writing <code>export * from &quot;./&lt;file name&gt;.ts&quot;;</code> in the <code>src/index.ts</code> file.</p>
				</blockquote>
				<p>For example, I&#39;ve created a <code>jesterRole.ts</code> file, with the code above inside:
				<img src="https://user-images.githubusercontent.com/60631511/201498357-1f794e8a-780e-49d9-bb3d-047fd94e526b.png" alt="image"></p>
				<a href="#assigning-the-role-to-a-player" id="assigning-the-role-to-a-player" style="color: inherit; text-decoration: none;">
					<h2>Assigning the role to a player</h2>
				</a>
				<a href="#event-listener" id="event-listener" style="color: inherit; text-decoration: none;">
					<h3>Event listener</h3>
				</a>
				<p>We can take advantage of SkeldJS&#39; <a href="../../classes/RoomAssignRolesEvent.html"><code>room.assignroles</code></a> event to assign the Jester role (unofficially, the client will still think they&#39;re a Crewmate other than cosmetics which we&#39;ll set <a href="#setting-jester-cosmetics">later</a>).</p>
				<p>Attaching a listener to your plugin will do the trick:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;room.assignroles&quot;</span><span style="color: #000000">)</span>
<span style="color: #795E26">onAssignRoles</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #001080">RoomAssignRolesEvent</span><span style="color: #000000">&lt;</span><span style="color: #001080">Room</span><span style="color: #000000">&gt;) {</span>

<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>See the page on {@link Event Listeners} for more information.</p>
				</blockquote>
				<blockquote>
					<p>Note the <code>&lt;Room&gt;</code> generic is required to notify SkeldJS&#39; type system that this event should come from one of Hindenburg&#39;s rooms.</p>
				</blockquote>
				<a href="#assign-logic" id="assign-logic" style="color: inherit; text-decoration: none;">
					<h3>Assign logic</h3>
				</a>
				<p>We don&#39;t need to worry about the complexities of assigning roles in Among Us. Instead, we can just write code to first gather all of the crewmates who don&#39;t have a role, and pick a random one out of those. There are a few ways to do this, but this is how I did it:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">crewmatePool</span><span style="color: #000000"> = [];</span>
<span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> [ </span><span style="color: #0070C1">player</span><span style="color: #000000">, </span><span style="color: #0070C1">assignedRole</span><span style="color: #000000"> ] </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">roleAssignments</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">assignedRole</span><span style="color: #000000"> !== </span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">.</span><span style="color: #795E26">push</span><span style="color: #000000">(</span><span style="color: #001080">player</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">randomCrewmateIdx</span><span style="color: #000000"> = </span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">random</span><span style="color: #000000">() * </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">crewmate</span><span style="color: #000000"> = </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">[</span><span style="color: #001080">randomCrewmateIdx</span><span style="color: #000000">];</span>
</code></pre>
				<p>Here, it&#39;s probably a good idea to store the jester somewhere to reference in other parts of the code, so try creating a property on the plugin class that should store the jester, like so:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-bg-gamemodes-jester&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">BgGamemodesJesterPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">RoomPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">jester</span><span style="color: #000000">?: </span><span style="color: #267F99">PlayerData</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;;</span>

<span style="color: #000000">    ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>The <code>?</code> marks that the jester either might not exist, or hasn&#39;t been set just quite <em>yet</em>. This is just for type safety with TypeScript.</p>
				</blockquote>
				<p>With that property created, you can then assign the jester to that random crewmate you selected. Although, you should probably check that a crewmate was actually found before we proceed. For example, back inside our <code>onAssignRoles</code> method:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">crewmate</span><span style="color: #000000"> === </span><span style="color: #0000FF">undefined</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000"> = </span><span style="color: #001080">crewmate</span><span style="color: #000000">;</span>
</code></pre>
				<p>Oh, and since we&#39;ll be changing the Jester&#39;s name later in the <a href="#setting-jester-cosmetics">cosmetics</a> section, we should probably store what their original name was so we can reset it and set it again later.</p>
				<p>Another property on the plugin class is needed:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-bg-gamemodes-jester&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">BgGamemodesJesterPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">RoomPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">jester</span><span style="color: #000000">?: </span><span style="color: #267F99">PlayerData</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;;</span>
<span style="color: #000000">    </span><span style="color: #001080">originalJesterName</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;&quot;</span><span style="color: #000000">;</span>

<span style="color: #000000">    ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>And to set the jester&#39;s original name property, back in the <code>onAssignRoles</code> method:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">originalJesterName</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">!.</span><span style="color: #001080">currentOutfit</span><span style="color: #000000">.</span><span style="color: #001080">name</span><span style="color: #000000">;</span>
</code></pre>
				<p>Now that we&#39;ve found our jester and done a bit of caching with the jester&#39;s original name, we can simply tell SkeldJS to assign this role to the client:</p>
				<pre><code class="language-ts"><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #795E26">setAssignment</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">, </span><span style="color: #001080">JesterRole</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #0000FF">typeof</span><span style="color: #000000"> </span><span style="color: #001080">BaseRole</span><span style="color: #000000">);</span>
</code></pre>
				<blockquote>
					<p>Note, the cast to <code>typeof BaseRole</code> is required as TypeScript is a bit difficult with matching class constructors, i.e. it can&#39;t detect fully that <code>JesterRole</code> extends <code>BaseRole</code>.</p>
				</blockquote>
				<p>So, our plugin should look <em>something</em> like this:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-bg-gamemodes-jester&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">BgGamemodesJesterPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">RoomPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">jester</span><span style="color: #000000">?: </span><span style="color: #267F99">PlayerData</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;;</span>
<span style="color: #000000">    </span><span style="color: #001080">originalJesterName</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;&quot;</span><span style="color: #000000">;</span>

<span style="color: #000000">    </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #001080">room</span><span style="color: #000000">: </span><span style="color: #267F99">Room</span><span style="color: #000000">, </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">config</span><span style="color: #000000">: </span><span style="color: #267F99">BgGamemodesJesterPluginConfig</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">super</span><span style="color: #000000">(</span><span style="color: #001080">room</span><span style="color: #000000">, </span><span style="color: #001080">config</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>

<span style="color: #000000">    @</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;room.assignroles&quot;</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #795E26">onAssignRoles</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #267F99">RoomAssignRolesEvent</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;) {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">crewmatePool</span><span style="color: #000000"> = [];</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> [ </span><span style="color: #0070C1">player</span><span style="color: #000000">, </span><span style="color: #0070C1">assignedRole</span><span style="color: #000000"> ] </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">roleAssignments</span><span style="color: #000000">) {</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">assignedRole</span><span style="color: #000000"> !== </span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">) {</span>
<span style="color: #000000">                </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">)</span>
<span style="color: #000000">                    </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">.</span><span style="color: #795E26">push</span><span style="color: #000000">(</span><span style="color: #001080">player</span><span style="color: #000000">);</span>
<span style="color: #000000">            }</span>
<span style="color: #000000">        }</span>

<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">crewmatePool</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000"> === </span><span style="color: #098658">0</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000"> = </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">[</span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">random</span><span style="color: #000000">() * </span><span style="color: #001080">crewmatePool</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">)] </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #267F99">PlayerData</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;;</span>
<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">originalJesterName</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">!.</span><span style="color: #001080">currentOutfit</span><span style="color: #000000">.</span><span style="color: #001080">name</span><span style="color: #000000">;</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">        </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #795E26">setAssignment</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">, </span><span style="color: #001080">JesterRole</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #0000FF">typeof</span><span style="color: #000000"> </span><span style="color: #001080">BaseRole</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#setting-jester-cosmetics" id="setting-jester-cosmetics" style="color: inherit; text-decoration: none;">
					<h2>Setting jester cosmetics</h2>
				</a>
				<p>A crucial part of having a custom role is for the player to be able to identify that they have been assigned that role, and since we don&#39;t have access to the client to create a mod, we&#39;ll have to manually set cosmetics that give the appearance of a jester to make it obvious. More notably, we can set the name <em>with colours</em> to create a &quot;tag&quot; or &quot;role&quot; system in the players&#39; names, for instance <code>[Jester] weakeyes</code>.</p>
				<a href="#creating-the-perspective" id="creating-the-perspective" style="color: inherit; text-decoration: none;">
					<h3>Creating the perspective</h3>
				</a>
				<p>We can use Hindenburg&#39;s <a href="../Plugins/Player Perspectives.html">Player Perspectives</a> to create an environment where only the Jester can see their cosmetics, and everyone else sees them as normal. This gives the same effect as how only the Impostor can see their names as red, whereas everyone else sees it as white.</p>
				<p>First, we&#39;ll need to create a <code>jesterPerspective</code> property on the class so we can store the perspective and destroy it later, when the jester gets voted out and the game ends:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">HindenburgPlugin</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;hbplugin-bg-gamemodes-jester&quot;</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">BgGamemodesJesterPlugin</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">RoomPlugin</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">jester</span><span style="color: #000000">?: </span><span style="color: #267F99">PlayerData</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Room</span><span style="color: #000000">&gt;;</span>
<span style="color: #000000">    </span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">?: </span><span style="color: #267F99">Perspective</span><span style="color: #000000">;</span>
<span style="color: #000000">    </span><span style="color: #001080">originalJesterName</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000"> = </span><span style="color: #A31515">&quot;&quot;</span><span style="color: #000000">;</span>

<span style="color: #000000">    ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<blockquote>
					<p>This can also be <code>?</code> (optional), as it won&#39;t exist at all times; only when a jester is playing/has been set.</p>
				</blockquote>
				<p>A good event to use for knowing when to create the perspective is the <a href="../../classes/PlayerSetRoleEvent.html"><code>player.setrole</code></a> event, which will be fired almost immediately after the one we used when assigning the role:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;player.setrole&quot;</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">onSetRole</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #001080">PlayerSetRoleEvent</span><span style="color: #000000">&lt;</span><span style="color: #001080">Room</span><span style="color: #000000">&gt;) {</span>

<span style="color: #000000">}</span>
</code></pre>
				<p>Now remember that this event can come from any player, so it&#39;s worth checking that we&#39;re actually dealing with the jester here. A good way to do this is to check that <a href="../../classes/PlayerSetRoleEvent.html"><code>ev.newRole</code></a> is equal to our jester role:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;player.setrole&quot;</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">onSetRole</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #001080">PlayerSetRoleEvent</span><span style="color: #000000">&lt;</span><span style="color: #001080">Room</span><span style="color: #000000">&gt;) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">newRole</span><span style="color: #000000"> !== </span><span style="color: #001080">JesterRole</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">; </span><span style="color: #008000">// quit if the player in question is not becoming a jester</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>in that same method, we can create the jesters&#39; perspective:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">logger</span><span style="color: #000000">.</span><span style="color: #795E26">info</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;%s is now a jester&quot;</span><span style="color: #000000">, </span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">);</span>

<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">createPerspective</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">, [], [ </span><span style="color: #001080">PresetFilter</span><span style="color: #000000">.</span><span style="color: #001080">GameDataUpdates</span><span style="color: #000000"> ]);</span>
</code></pre>
				<p>The <em>outgoing filter</em> <code>PresetFilter.GameDataUpdates</code> is used to prevent the Jester&#39;s cosmetics and tagged name from being updated on the other players&#39; screens.</p>
				<blockquote>
					<p>Reading the page on <a href="../Plugins/Player Perspectives.html">Player Perspectives</a> is recommended here.</p>
				</blockquote>
				<a href="#setting-the-cosmetics" id="setting-the-cosmetics" style="color: inherit; text-decoration: none;">
					<h3>Setting the cosmetics</h3>
				</a>
				<p>Still in your <code>onSetRole</code> method, we can simply get the jesters&#39; player in the room and set all of their cosmetics using SkeldJS&#39; API.</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">jesterPov</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #795E26">resolvePlayer</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">); </span><span style="color: #008000">// get the jesters&#039; player on their perspective, since the jester we have is the same player in the main room</span>

<span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">jesterPov</span><span style="color: #000000"> || !</span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">) </span><span style="color: #008000">// for type safety, check if these two variables actually exist before using them</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setName</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;&lt;color=purple&gt;[Jester]&lt;/color&gt; &quot;</span><span style="color: #000000"> + </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">originalJesterName</span><span style="color: #000000">);</span>
<span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setHat</span><span style="color: #000000">(</span><span style="color: #001080">Hat</span><span style="color: #000000">.</span><span style="color: #001080">Partyhat</span><span style="color: #000000">);</span>
<span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setSkin</span><span style="color: #000000">(</span><span style="color: #001080">Skin</span><span style="color: #000000">.</span><span style="color: #001080">Clown</span><span style="color: #000000">);</span>
<span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setPet</span><span style="color: #000000">(</span><span style="color: #001080">Pet</span><span style="color: #000000">.</span><span style="color: #001080">EmptyPet</span><span style="color: #000000">);</span>
</code></pre>
				<p>We should now see <em>two</em> changes:
					<img src="https://user-images.githubusercontent.com/60631511/201499213-7445beb4-75c9-4c77-b9a1-a13813e67b81.png" alt="image">
				<img src="https://user-images.githubusercontent.com/60631511/201499218-a7b8334d-a5e6-4523-9f1b-9a6e7ca339cc.png" alt="image"></p>
				<a href="#fixing-bugs" id="fixing-bugs" style="color: inherit; text-decoration: none;">
					<h3>Fixing bugs</h3>
				</a>
				<p>One thing you might notice if you played this now, is that the Jester&#39;s cosmetics never appear properly in meetings; that is, they will appear as a normal character.</p>
				<p>This bug is simply something we didn&#39;t consider with our perspective and its filters: since the main room never knows of the jesters&#39; cosmetics (as it&#39;s contained within their perspective), and we have no <em>incoming filters</em> to block updates from the main room, the main room will send an update to the perspective to update their GameData/cosmetics info (likely to update their role), thus overriding what we set it to in their perspective.</p>
				<blockquote>
					<p>Overriding GameData won&#39;t immediately update the player, hence why it only shows after-the-fact in meetings. The <a href="../../classes/SetNameMessage.html">SetNameMessage</a>, <a href="../../classes/SetColorMessage.html">SetColorMessage</a>, <a href="../../classes/SetHatMessage.html">SetHatMessage</a>, <a href="../../classes/SetPetMessage.html">SetPetMessage</a>, <a href="../../classes/SetSkinMessage.html">SetSkinMessage</a> can be used for immediate updates.</p>
				</blockquote>
				<blockquote>
					<p>For more information on how innernet objects keep state, see <a href="../../enums/DisconnectReason.html#Custom">Innernet Objects</a>.</p>
				</blockquote>
				<p>To fix this, we have to create our own <em>incoming filter</em> to prevent this exact thing.</p>
				<p>So, just after our line that creates our perspective:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">createPerspective</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">, [], [ </span><span style="color: #001080">PresetFilter</span><span style="color: #000000">.</span><span style="color: #001080">GameDataUpdates</span><span style="color: #000000"> ]);</span>

<span style="color: #000000">...</span>
</code></pre>
				<p>We can create our own incoming filter:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #001080">incomingFilter</span><span style="color: #000000">.</span><span style="color: #795E26">on</span><span style="color: #000000">(</span><span style="color: #001080">DataMessage</span><span style="color: #000000">, </span><span style="color: #001080">message</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000"> || !</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">obj</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #001080">netobjects</span><span style="color: #000000">.</span><span style="color: #795E26">get</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">netId</span><span style="color: #000000">);</span>

<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">obj</span><span style="color: #000000"> || !(</span><span style="color: #001080">obj</span><span style="color: #000000"> </span><span style="color: #0000FF">instanceof</span><span style="color: #000000"> </span><span style="color: #267F99">GameData</span><span style="color: #000000">))</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">    ...</span>
<span style="color: #000000">});</span>
</code></pre>
				<p>After the last <code>return;</code> in this piece of code, <code>message</code> is certain to be coming from an update for the GameData message, containing cosmetics updates. As this message in particular may be overriding the cosmetics that we set for the Jester, we ought to check and process it in a special way if it does, so as to prevent an override.</p>
				<a href="#check-that-the-jesters39-cosmetics-are-being-overriden" id="check-that-the-jesters39-cosmetics-are-being-overriden" style="color: inherit; text-decoration: none;">
					<h4>Check that the jesters&#39; cosmetics are being overriden</h4>
				</a>
				<p>The <a href="../../classes/GameData.html">GameData</a> update message is formatted as a dictionary from player ID -&gt; player cosmetics. We can do a quick skim over this dictionary to find whether or not the jesters&#39; player ID appears inside it.</p>
				<p>Firstly, get the jesters&#39; player ID:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">jesterPov</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #795E26">resolvePlayer</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">);</span>

<span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">jesterPov</span><span style="color: #000000"> || !</span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">jesterPlayerId</span><span style="color: #000000"> = </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #001080">playerId</span><span style="color: #000000">;</span>
</code></pre>
				<p>Next, skim through the GameData update and check if the player appears:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080">flag</span><span style="color: #000000"> = </span><span style="color: #0000FF">false</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">reader</span><span style="color: #000000"> = </span><span style="color: #001080">HazelReader</span><span style="color: #000000">.</span><span style="color: #795E26">from</span><span style="color: #000000">(</span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #001080">data</span><span style="color: #000000">);</span>
<span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #001080">left</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> [ </span><span style="color: #0070C1">playerId</span><span style="color: #000000"> ] = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">message</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">playerId</span><span style="color: #000000"> === </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #001080">playerId</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #001080">flag</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">break</span><span style="color: #000000">;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#process-the-gamedata-message-specially-to-prevent-the-jester39s-cosmetics-from-being-overriden" id="process-the-gamedata-message-specially-to-prevent-the-jester39s-cosmetics-from-being-overriden" style="color: inherit; text-decoration: none;">
					<h4>Process the gamedata message specially to prevent the Jester&#39;s cosmetics from being overriden</h4>
				</a>
				<p>The idea here is to <em>cancel</em> the message, so as to stop the perspectve from processing it. Instead, we&#39;ll process it manually and re-set the Jesters&#39; cosmetics straight after:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">flag</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #001080">message</span><span style="color: #000000">.</span><span style="color: #795E26">cancel</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #001080">obj</span><span style="color: #000000">.</span><span style="color: #795E26">Deserialize</span><span style="color: #000000">(</span><span style="color: #001080">reader</span><span style="color: #000000">, </span><span style="color: #0000FF">false</span><span style="color: #000000">);</span>

<span style="color: #000000">    </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #795E26">setName</span><span style="color: #000000">(</span><span style="color: #001080">PlayerOutfitType</span><span style="color: #000000">.</span><span style="color: #001080">Default</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;&lt;color=purple&gt;[Jester]&lt;/color&gt; &quot;</span><span style="color: #000000"> + </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">originalJesterName</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #795E26">setHat</span><span style="color: #000000">(</span><span style="color: #001080">PlayerOutfitType</span><span style="color: #000000">.</span><span style="color: #001080">Default</span><span style="color: #000000">, </span><span style="color: #001080">Hat</span><span style="color: #000000">.</span><span style="color: #001080">Partyhat</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #795E26">setSkin</span><span style="color: #000000">(</span><span style="color: #001080">PlayerOutfitType</span><span style="color: #000000">.</span><span style="color: #001080">Default</span><span style="color: #000000">, </span><span style="color: #001080">Skin</span><span style="color: #000000">.</span><span style="color: #001080">Clown</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #001080">jesterPov</span><span style="color: #000000">.</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #795E26">setPet</span><span style="color: #000000">(</span><span style="color: #001080">PlayerOutfitType</span><span style="color: #000000">.</span><span style="color: #001080">Default</span><span style="color: #000000">, </span><span style="color: #001080">Pet</span><span style="color: #000000">.</span><span style="color: #001080">EmptyPet</span><span style="color: #000000">);</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#jester-getting-voted-out" id="jester-getting-voted-out" style="color: inherit; text-decoration: none;">
					<h2>Jester getting voted out</h2>
				</a>
				<p>Now, things from here start to get a bit more tricky and specific. Luckily, the Jester has fairly simple gameplay changes - just check if a jester gets ejected after a meeting.</p>
				<p>From what we know in {@link Object Ownership Guards} and {@link Event Targets}, we&#39;ll have to create event listeners on both the <em>main room</em> and the <em>Jester&#39;s perspective</em> to listen for meetings.</p>
				<blockquote>
					<p>This is because, if the meeting is started by the Jester, then the meeting is said to <em>belong</em> to the perspective, whereas if the meeting is started by another player, then the meeting <em>belongs</em> to the main room.</p>
				</blockquote>
				<p>This doesn&#39;t have to make perfect sense right now, as it only requires an extra single line.</p>
				<a href="#creating-the-event-target" id="creating-the-event-target" style="color: inherit; text-decoration: none;">
					<h3>Creating the event target</h3>
				</a>
				<p>Either way, we should create an <em>event target</em> to host the events that we need to listen for. This can act as our sort-of &quot;jester behaviour&quot; class, which handles all of the logic for the jester. This warrants a new file in my opinion. This file can initially be simply:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">EventTarget</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@skeldjs/hindenburg&quot;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">BgGamemodesJesterPlugin</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;./plugin&quot;</span><span style="color: #000000">;</span>

<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">JesterRoleBehaviour</span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99">EventTarget</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span><span style="color: #0000FF">protected</span><span style="color: #000000"> </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #001080">plugin</span><span style="color: #000000">: </span><span style="color: #267F99">BgGamemodesJesterPlugin</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">super</span><span style="color: #000000">();</span>
<span style="color: #000000">    }</span>

<span style="color: #000000">    @</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;room.gameend&quot;</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #795E26">onGameEnd</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #267F99">RoomGameEndEvent</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">removeEventTarget</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Note that this class has a <code>plugin</code> parameter for your plugin to pass itself into. This is just so we can reference it in the event target itself.</p>
				<p>The last part with the <a href="../../classes/RoomGameEndEvent.html"><code>room.gameend</code></a> event is a precaution to make sure event listeners don&#39;t stick around on the event even once the game has ended. This doesn&#39;t impact the perspective, as we&#39;ll destroy that at the end of the match anyway.</p>
				<p>My file structure now looks like the following:
				<img src="https://user-images.githubusercontent.com/60631511/201499386-1cf6d8e2-d52e-4098-9aa7-f242c4c5d4c9.png" alt="image"></p>
				<blockquote>
					<p>Remember to also export this file in your <code>src/index.ts</code> file with <code>export * from &quot;./jesterRoleBehaviour&quot;;</code></p>
				</blockquote>
				<a href="#registering-the-event-target" id="registering-the-event-target" style="color: inherit; text-decoration: none;">
					<h3>Registering the event target</h3>
				</a>
				<p>Back in your <code>onSetRole</code> method in your plugin, you can attach the following code at the end:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">jesterRoleBehaviour</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">JesterRoleBehaviour</span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">);</span>
<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">jesterRoleBehaviour</span><span style="color: #000000">);</span>
<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #795E26">registerEventTarget</span><span style="color: #000000">(</span><span style="color: #001080">jesterRoleBehavour</span><span style="color: #000000">);</span>
</code></pre>
				<p>This will create an instance of the event target that we created, and register it both on the room and the jesters&#39; perspective, as discussed earlier.</p>
				<a href="#writing-the-event-handler" id="writing-the-event-handler" style="color: inherit; text-decoration: none;">
					<h3>Writing the event handler</h3>
				</a>
				<p>Now, in our new event target class, we can register a <a href="../../classes/PlayerDieEvent.html"><code>player.die</code></a> to handle when the player gets ejected from the meeting:</p>
				<pre><code class="language-ts"><span style="color: #000000">@</span><span style="color: #795E26">EventListener</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;player.die&quot;</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">onPlayerDie</span><span style="color: #000000">(</span><span style="color: #001080">ev</span><span style="color: #000000">: </span><span style="color: #001080">PlayerDieEvent</span><span style="color: #000000">&lt;</span><span style="color: #001080">Room</span><span style="color: #000000">&gt;) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000"> || !</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #001080">gameData</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">reason</span><span style="color: #000000"> !== </span><span style="color: #A31515">&quot;exiled&quot;</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">ev</span><span style="color: #000000">.</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">clientId</span><span style="color: #000000"> !== </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">.</span><span style="color: #001080">clientId</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span>

<span style="color: #000000">    ...</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>The series of checks here should be fairly obvious, but they&#39;re just to make sure we&#39;re handling the right kind of death and for the right player.</p>
				<blockquote>
					<p>Note that the <code>ev.player.clientId !== this.plugin.jester.clientId</code> matches client IDs rather than player reference, as the event might refer to the jester in the perspectve while the plugin one refers to the jester in the main room, thus beng different references.</p>
				</blockquote>
				<p>Now, very simply to get this all working, we can simply end the game:</p>
				<pre><code class="language-ts"><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">registerEndGameIntent</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">EndGameIntent</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;jester voted out&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">GameOverReason</span><span style="color: #000000">.</span><span style="color: #001080">ImpostorByVote</span><span style="color: #000000">,</span>
<span style="color: #000000">        {</span>
<span style="color: #000000">            </span><span style="color: #001080">jester:</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">!</span>
<span style="color: #000000">        }</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">);</span>
</code></pre>
				<a href="#end-game-screen" id="end-game-screen" style="color: inherit; text-decoration: none;">
					<h2>End game screen</h2>
				</a>
				<p>You&#39;ll notice that in the last end game screen, the winner always shows as the impostor, even though the Jester won the game.</p>
				<p>To fix this, we&#39;ll need to break the game a little bit.</p>
				<p>Now, the first idea is to simply re-set everyone&#39;s role before the game ends so that the Jester becomes the impostor, the impostors becomes crewmates and crewmates stay as crewmates. For example, before your line for <code>this.plugin.room.registerEndGameIntent</code>:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> [ , </span><span style="color: #0070C1">player</span><span style="color: #000000"> ] </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #001080">players</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!</span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">continue</span><span style="color: #000000">;</span>

<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">player</span><span style="color: #000000"> === </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setRole</span><span style="color: #000000">(</span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">);</span>
<span style="color: #000000">    } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">player</span><span style="color: #000000">.</span><span style="color: #001080">control</span><span style="color: #000000">.</span><span style="color: #795E26">setRole</span><span style="color: #000000">(</span><span style="color: #001080">CrewmateRole</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>This <em>would</em> work. However, the Among Us client has several locks in place to prevent the role from being re-assigned after being initially assigned.</p>
				<p>One way to get around this is to consider that the locks exist <em>only</em> on the GameData instance. Therefore, the idea is to <em>despawn</em> the GameData instance, and <em>respawn it</em> immediately after with the new roles set.</p>
				<p>So, instead of the code above:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jesterPerspective</span><span style="color: #000000">.</span><span style="color: #795E26">destroyPerspective</span><span style="color: #000000">();</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">gameDataPlayers</span><span style="color: #000000"> = </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #001080">gameData</span><span style="color: #000000">.</span><span style="color: #001080">players</span><span style="color: #000000">;</span>
<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #001080">gameData</span><span style="color: #000000">!.</span><span style="color: #795E26">despawn</span><span style="color: #000000">();</span>

<span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">const</span><span style="color: #000000"> [ , </span><span style="color: #0070C1">playerInfo</span><span style="color: #000000"> ] </span><span style="color: #0000FF">of</span><span style="color: #000000"> </span><span style="color: #001080">gameDataPlayers</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #001080">playerId</span><span style="color: #000000"> === </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">jester</span><span style="color: #000000">.</span><span style="color: #001080">playerId</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #001080">roleType</span><span style="color: #000000"> = </span><span style="color: #001080">ImpostorRole</span><span style="color: #000000">;</span>
<span style="color: #000000">    } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">playerInfo</span><span style="color: #000000">.</span><span style="color: #001080">roleType</span><span style="color: #000000"> = </span><span style="color: #001080">CrewmateRole</span><span style="color: #000000">;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">plugin</span><span style="color: #000000">.</span><span style="color: #001080">room</span><span style="color: #000000">.</span><span style="color: #795E26">spawnPrefabOfType</span><span style="color: #000000">(</span><span style="color: #001080">SpawnType</span><span style="color: #000000">.</span><span style="color: #001080">GameData</span><span style="color: #000000">, -</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">, [</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">        </span><span style="color: #001080">players:</span><span style="color: #000000"> </span><span style="color: #001080">gameDataPlayers</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">], </span><span style="color: #0000FF">true</span><span style="color: #000000">, </span><span style="color: #0000FF">false</span><span style="color: #000000">);</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting <wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installation.html">Installation</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Environment Variables.html">Environment <wbr>Variables</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Configuration.html">Configuration</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Installing Plugins.html">Installing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Contributing.html">Contributing</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Getting Started/Comparison with Impostor.html">Comparison with <wbr>Impostor</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Using <wbr>Hindenburg</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Logging Config.html">Logging <wbr>Config</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Reactor Support.html">Reactor <wbr>Support</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Server-as-a-Host.html">Server-<wbr>as-<wbr>a-<wbr>Host</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Using Hindenburg/Server-as-a-Host.html">Interactive CLI</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Advanced <wbr>Usage</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Unknown Innernet Objects.html">Unknown <wbr>Innernet <wbr>Objects</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Usage/Message Ordering.html">Message <wbr>Ordering</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Plugins</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Creating a Plugin.html">Creating a <wbr>Plugin</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Developing Plugins.html">Developing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Compatible Hindenburg API Versions.html">Compatible <wbr>Hindenburg API <wbr>Versions</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Publishing Plugins.html">Publishing <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Load Ordering.html">Load <wbr>Ordering</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Worker and Room Plugins.html">Worker and <wbr>Room <wbr>Plugins</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Dependencies.html">Dependencies</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Lifecycle Methods.html">Lifecycle <wbr>Methods</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Event Listeners.html">Event <wbr>Listeners</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Receiving Protocol Messages.html">Receiving <wbr>Protocol <wbr>Messages</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Chat Commands.html">Chat <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Player Perspectives.html">Player <wbr>Perspectives</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Event Targets.html">Event <wbr>Targets</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Reactor Integration.html">Reactor <wbr>Integration</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/End Game Intents.html">End <wbr>Game <wbr>Intents</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Server Broadcast.html">Server <wbr>Broadcast</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/CLI Commands.html">CLI <wbr>Commands</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Roles.html">Custom <wbr>Roles</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Innernet Objects.html">Custom <wbr>Innernet <wbr>Objects</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Custom Protocol Messages.html">Custom <wbr>Protocol <wbr>Messages</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Plugins/Game Codes.html">Game <wbr>Codes</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Advanced <wbr>Topics</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../Advanced Topics/Object Ownership Guards.html">Object <wbr>Ownership <wbr>Guards</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Guides</span>
					</li>
					<li class="current pp-nav pp-page">
						<a href="New Roles.html">New <wbr>Roles</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="Floating Text.html">Floating <wbr>Text</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>